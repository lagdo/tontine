/*
    @package jaxon
    @version $Id: jaxon.debug.js 327 2007-02-28 16:55:26Z calltoconstruct $
    @copyright Copyright (c) 2005-2007 by Jared White & J. Max Wilson
    @copyright Copyright (c) 2008-2009 by Joseph Woolley, Steffen Konerow, Jared White  & J. Max Wilson
    @license http://www.jaxonproject.org/bsd_license.txt BSD License
*/
try{if("undefined"==typeof jaxon)throw{name:"SequenceError",message:"Error: Jaxon core was not detected, debug module disabled."};void 0===jaxon.debug&&(jaxon.debug={}),jaxon.debug.active=!0}catch(e){alert(e.name+": "+e.message)}!function(e,n,t,o,r,s){e.windowSource="about:blank",e.windowID="jaxon_debug_window",e.windowStyle="width=800,height=600,scrollbars=yes,resizable=yes,status=yes",e.windowTemplate='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>jaxon debug output</title><style type="text/css">/* <![CDATA[ */.debugEntry { margin: 3px; padding: 3px; border-top: 1px solid #999999; } .debugDate { font-weight: bold; margin: 2px; } .debugText { margin: 2px; } .warningText { margin: 2px; font-weight: bold; } .errorText { margin: 2px; font-weight: bold; color: #ff7777; }/* ]]> */</style></head><body><h2>jaxon debug output</h2><div id="debugTag"></div></body></html>',e.isLoaded=!0,e.verbose.isLoaded=!1,e.verbose.active=!1;const a=function(n){if(void 0!==n.code){if(void 0!==e.exceptions[n.code]){const t=e.exceptions[n.code];return void 0!==n.data&&t.replace("{data}",n.data),t}}else if(void 0!==n.name){return void 0!==n.message?n.name+": "+n.message:n.name}return"An unknown error has occurred."};e.prepareDebugText=function(n){try{return n=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")}catch(t){const o=function(e,n,t){const o=e.split(n);e="";for(let n=0;n<o.length;++n)0!=n&&(e+=t),e+=o[n];return e};e.prepareDebugText=function(e){return e=o(e,"&","&amp;"),e=o(e,"<","&lt;"),e=o(e,">","&gt;"),e=o(e,"\n","<br />")},e.prepareDebugText(n)}};const c=function(n,t,o){try{e.window&&!e.window.closed||(e.window=window.open(e.windowSource,e.windowID,e.windowStyle),"about:blank"===e.windowSource&&e.window.document.write(e.windowTemplate)),void 0===t&&(t=""),void 0===o&&(o="debugText"),n=e.prepareDebugText(n);const r=e.window.document,s=r.getElementById("debugTag"),a=r.createElement("div"),c=r.createElement("span"),i=r.createElement("pre");c.innerHTML=(new Date).toString(),i.innerHTML=t+n,a.appendChild(c),a.appendChild(i),s.insertBefore(a,s.firstChild);try{a.className="debugEntry",c.className="debugDate",i.className=o}catch(e){}}catch(t){n.length>1500&&(n=n.substr(0,1500)+" ...\n(Truncated)"),alert(e.messages.heading+n)}},i=r.unregister("script.debug");r.register("script.debug",(({message:n})=>(c(n,e.messages.warning,"warningText"),i({message:n}))));const u=r.execute;r.execute=function(n){const{sequence:t,command:{name:o,fullName:s,args:i}}=n;try{if(void 0===o)throw{code:10006};if(0==r.isRegistered({name:o}))throw{code:10007,data:o};return u(n)}catch(n){let o="jaxon.ajax.command.execute (";void 0!==t&&(o+="#"+t+", "),void 0!==s&&(o+='"'+s+'"'),void 0!==i&&(o+=JSON.stringify(i)),o+="):\n"+a(n)+"\n",c(o,e.messages.error,"errorText")}return!0};const d=r.callHandler;r.callHandler=function(n,t,o){const{command:{fullName:r},component:s}=o;try{const a=d(n,t,o);return c(e.messages.processing.calling.supplant({cmd:r||n,options:JSON.stringify({...s?{component:s}:{},args:t},null,2)})),a}catch(n){const t="jaxon.ajax.command.callHandler: "+a(n)+"\n";throw c(t,e.messages.error,"errorText"),n}};const l=s.dom.$;s.dom.$=function(n){try{const e=l(n);if("object"!=typeof e)throw{code:10008};return e}catch(n){const t="$:"+a(n)+"\n";c(t,e.messages.warning,"warningText")}};const g=t._send;t._send=function(n){try{const t=n.requestData.length||0;c(e.messages.request.sending),n.beginDate=new Date,g(n),c(e.messages.request.sent.supplant({length:t}))}catch(n){const t="jaxon.ajax.request._send: "+a(n)+"\n";throw c(t,e.messages.error,"errorText"),n}};const m=t.submit;t.submit=function(n){let t=n.method+": "+n.URI+"\n",o=decodeURIComponent(n.requestData);o=o.replace(new RegExp("&jxn","g"),"\n&jxn"),t+=o,c(t),t=e.messages.request.calling;for(let e in n.functionName)t+="\n"+e+": "+n.functionName[e];c(t);try{return m(n)}catch(e){if(c(e.message),0<n.retry)throw e}};const p=t.initialize;t.initialize=function(n){try{const t=e.messages.request.init;return c(t),p(n)}catch(n){const t="jaxon.ajax.request.initialize: "+a(n)+"\n";throw c(t,e.messages.error,"errorText"),n}};const x=n.process;n.process=function(n){try{if(void 0!==n.parameters){const t=e.messages.processing.parameters.supplant({count:n.parameters.length});c(t)}else{const n=e.messages.processing.no_parameters;c(n)}return x(n)}catch(n){const t="jaxon.ajax.parameters.process: "+a(n)+"\n";throw c(t,e.messages.error,"errorText"),n}};const f=t.prepare;t.prepare=function(n){try{const t=e.messages.request.preparing;return c(t),f(n)}catch(n){const t="jaxon.ajax.request.prepare: ";throw a(n),c(t,e.messages.error,"errorText"),n}};const j=t.execute;t.execute=function(){try{c(e.messages.request.starting);const n=arguments.length;if(0==n)throw{code:10010};const t=arguments[0],o=1<n?arguments[1]:{};return o.debugging=!0,j(t,o)}catch(n){const t="jaxon.ajax.request.execute: "+a(n)+"\n";throw c(t,e.messages.error,"errorText"),n}};const h=o.received;o.received=function(n){try{const t=n.response.status;if(o.isSuccessCode(t)){n.midDate=new Date;const o=e.messages.response.success.supplant({status:t,length:JSON.stringify(n.responseContent).length,duration:n.midDate-n.beginDate})+"\n"+JSON.stringify(n.responseContent,null,2);c(o)}else if(o.isErrorCode(t)){const o=e.messages.response.content.supplant({status:t,text:JSON.stringify(n.responseContent,null,2)});c(o,e.messages.error,"errorText")}else if(o.isRedirectCode(t)){const t=e.messages.response.redirect.supplant({location:n.response.headers.get("location")});c(t)}return h(n)}catch(n){const t="jaxon.ajax.response.received: "+a(n)+"\n";c(t,e.messages.error,"errorText")}return null};const w=o.complete;if(o.complete=function(n){try{const t=w(n);n.endDate=new Date;const o=n.endDate-n.beginDate,r=e.messages.processing.done.supplant({duration:o});return c(r),t}catch(n){const t="jaxon.ajax.response.complete: "+a(n)+"\n";throw c(t,e.messages.error,"errorText"),n}},jaxon.cmd.node.assign){const n=jaxon.cmd.node.assign;jaxon.cmd.node.assign=function({target:t,prop:o,data:r}){try{return n(t,o,r)}catch(n){const t="jaxon.cmd.node.assign: "+a(n)+"\nEval: element."+o+" = data;\n";c(t,e.messages.error,"errorText")}return!0}}}(jaxon.debug,jaxon.ajax.parameters,jaxon.ajax.request,jaxon.ajax.response,jaxon.ajax.command,jaxon.utils),jaxon.dom.ready((function(){(function(self){if(!self.active)return;const expandObject=function(e){if("function"==typeof e)return"[Function]";if("object"==typeof e){if(1==(!(1<arguments.length)||arguments[1])){let n=" { ",t="";for(let o in e){n+=t,n+=o,n+=": ";try{n+=expandObject(e[o],!1)}catch(e){n+="[n/a]"}t=", "}return n+=" } ",n}return"[Object]"}return'"'+e+'"'},makeFunction=function(obj,name){return function(){let fun=name+"(",separator="";const pLen=arguments.length;for(let e=0;e<pLen;++e)fun+=separator,fun+=expandObject(arguments[e]),separator=",";fun+=");";let msg="--\x3e "+fun;writeDebugMessage(msg);const returnValue=!0;let code="returnValue = obj(";separator="";for(let e=0;e<pLen;++e)code+=separator+"arguments["+e+"]",separator=",";return code+=");",eval(code),msg="<-- "+fun+" returns "+expandObject(returnValue),writeDebugMessage(msg),returnValue}};self.hook=function(e,n){for(let t in e)"function"==typeof e[t]&&(e[t]=makeFunction(e[t],n+t))},self.hook(jaxon,"jaxon."),self.hook(jaxon.cmd.node,"jaxon.cmd.node."),self.hook(jaxon.cmd.event,"jaxon.cmd.event."),self.hook(jaxon.cmd.script,"jaxon.cmd.script."),self.hook(jaxon.utils.dom,"jaxon.utils.dom."),self.hook(jaxon.utils.string,"jaxon.utils.string."),self.hook(jaxon.utils.queue,"jaxon.utils.queue."),self.hook(jaxon.utils.upload,"jaxon.utils.upload."),self.hook(jaxon.ajax.callback,"jaxon.ajax.callback."),self.hook(jaxon.ajax.command,"jaxon.ajax.command."),self.isLoaded=!0})(jaxon.debug.verbose)}));